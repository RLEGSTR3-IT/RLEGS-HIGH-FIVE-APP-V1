<!DOCTYPE html>
<html lang="id">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	<meta name="theme-color" content="#E85D04">
	<title>RLEGS III High Five</title>
	<!-- Telegram SDK -->
	<script src="https://telegram.org/js/telegram-web-app.js"></script>
	<!-- Font Awesome for better icons -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<!-- Custom styles -->
	<link rel="stylesheet" href="style.css">
</head>

<body>
	<!-- Main App Container -->
	<div id="app" class="app-container" style="display: block;">
		<header class="app-header">
			<div class="header-content">
				<div class="brand-section">
					<div class="brand-text">
						<h1>RLEGS III High Five</h1>
						<p>Pendataan Program High Five RLEGS</p>
					</div>
				</div>
			</div>
		</header>

		<!-- TODO: Change elements' names and ids to its corresponding context -->

		<div id="mainMenu" class="main-content">
			<div class="welcome-section">
				<h2>Pilih Jenis Kegiatan</h2>
				<p>Silakan pilih kegiatan yang Anda lakukan</p>
			</div>

			<div class="activity-menu">
				<!-- Card for Visit -->
				<div class="activity-item visit-item" onclick="selectActivity('Visit')">
					<div class="activity-icon">
						<div class="icon-wrapper visit-bg">
							<!-- Use FontAwesome icon instead of emoji -->
							<i class="fa-solid fa-city"></i>
						</div>
						<span class="activity-badge">14 Fields</span>
					</div>
					<div class="activity-info">
						<h3>VISIT</h3>
						<p>Kunjungan ke Targeted Customers untuk menggali opportunity High Five
							products</p>
						<div class="activity-features">
							<span>Data Visit Customers</span>
							<span>Data PIC Customers</span>
							<span>Foto Evidence Visit</span>
						</div>
					</div>
					<button class="activity-btn">
						<span>MULAI</span>
						<div class="btn-arrow">→</div>
					</button>
				</div>

				<!-- Card for Dealing -->
				<div class="activity-item dealing-item" onclick="selectActivity('Dealing')">
					<div class="activity-icon">
						<div class="icon-wrapper dealing-bg">
							<!-- Use FontAwesome handshake icon -->
							<i class="fa-solid fa-handshake"></i>
						</div>
						<span class="activity-badge">14 Fields</span>
					</div>
					<div class="activity-info">
						<h3>DEALING</h3>
						<p>Tahap dealing High Five products dengan customers</p>
						<div class="activity-features">
							<span>Data Dealing Customers</span>
							<span>Data Kontrak Berlangganan</span>
							<span>Foto Evidence Dealing</span>
						</div>
					</div>
					<button class="activity-btn">
						<span>MULAI</span>
						<div class="btn-arrow">→</div>
					</button>
				</div>
				<form method="POST" action="/auth/logout">
					<button type="submit" class="submit-btn" id="submitButton">Log Out</button>
				</form>
			</div>
		</div>

		<!-- Form Container -->
		<div id="formContainer" class="main-content" style="display: none;">
			<div class="form-header">
				<button class="back-btn" onclick="backToMenu()">
					<span class="back-icon">←</span>
					<span>Kembali</span>
				</button>
				<div class="form-title" id="formTitle">Form High Five</div>
			</div>

			<!-- NOTE: Option Dealing -->
			<div id="dealing-cat-opts" class="dealing-opts" style="display: none;">
				<h3>Pilih Jenis Dealing</h3>
				<br>

				<div class="deal-switch" id="dealSwitch" role="switch" tabindex="0" aria-checked="false"
					data-pos="left">
					<!-- off-track labels that slide in -->
					<span class="edge-label bakn">BAKN/SPPJB</span>
					<span class="edge-label kontrak">Kontrak</span>

					<!-- circular knob -->
					<div class="knob" aria-hidden="true"></div>

					<input type="hidden" name="mode" id="mode" value="kontrak">
				</div>
			</div>

			<!-- Progress Bar -->
			<div class="progress-container">
				<div class="progress-info">
					<span class="progress-text">Progress</span>
					<span class="progress-count">
						<span id="currentStep">0</span>/<span id="totalSteps">15</span>
					</span>
				</div>
				<div class="progress-bar">
					<div class="progress-fill" id="progressFill"></div>
				</div>
				<div class="progress-percent" id="progressPercent">0%</div>
			</div>

			<!-- Data Entry Form -->
			<form id="dataForm" class="data-form">
				<div class="form-section">
					<div class="section-title">
						<h3>Informasi Visit</h3>
					</div>

					<div class="input-group">
						<label for="kode_sa">NIK Account Manager
							<span class="required">*</span></label>
						<input type="text" id="kode_sa" name="kode_sa" required
							placeholder="Masukkan NIK Account Manager" maxlength="20"
							inputmode="numeric">
						<div class="error-msg" id="error_kode_sa"></div>
					</div>

					<div class="input-group">
						<label for="nama">Nama Lengkap <span class="required">*</span></label>
						<input type="text" id="nama" name="nama" required
							placeholder="Masukkan nama lengkap">
						<div class="error-msg" id="error_nama"></div>
					</div>

					<div class="input-group">
						<label for="witel">Witel <span class="required">*</span></label>
						<select id="witel" name="witel" required>
							<option value="">Pilih Witel</option>
							<option value="Bali">Bali</option>
							<option value="Jatim Barat">Jatim Barat</option>
							<option value="Jatim Timur">Jatim Timur</option>
							<option value="Nusa Tenggara">Nusa Tenggara</option>
							<option value="Semarang Jateng">Semarang Jateng Utara</option>
							<option value="Solo Jateng Timur">Solo Jateng Timur</option>
							<option value="Suramadu">Suramadu</option>
							<option value="Yogya Jateng Selatan">Yogya Jateng Selatan
							</option>
						</select>
						<div class="error-msg" id="error_witel"></div>
					</div>

					<div class="input-group">
						<label for="tanggal">Tanggal Visit <span
								class="required">*</span></label>
						<input type="date" id="tanggal" name="tanggal" required>
						<div class="error-msg" id="error_tanggal"></div>
					</div>
				</div>

				<!-- TODO: Change Customer Selection to Drop Down Later -->
				<div class="form-section">
					<div class="input-group">
						<label for="tenant">Nama Client <span class="required">*</span></label>
						<input type="text" id="tenant" name="tenant" required
							placeholder="Nama client yang dikunjungi">
						<div class="error-msg" id="error_tenant"></div>
					</div>

					<!-- Hidden input to store activity type -->
					<input type="hidden" id="kegiatan" name="kegiatan">
				</div>

				<!-- Visit specific fields -->
				<div id="visitFields" class="form-section" style="display: none;">
					<div class="section-title">
						<h3>Detail Visit Client</h3>
					</div>

					<div class="input-group">
						<label>Opportunity yang didapat saat Visit?<span class="required">*</span></label>
						<div class="checkbox-group">
							<label class="checkbox-label">
								<input type="checkbox" name="layanan[]" value="Connectivity">
								<span>Connectivity</span>
							</label>
							<label class="checkbox-label">
								<input type="checkbox" name="layanan[]" value="Product Digital">
								<span>Product Digital</span>
							</label>
							<label class="checkbox-label">
								<input type="checkbox" name="layanan[]" value="Cyber Security">
								<span>Cyber Security</span>
							</label>
							<label class="checkbox-label">
								<input type="checkbox" name="layanan[]" value="Neucentrix">
								<span>Neucentrix</span>
							</label>
							<label class="checkbox-label">
								<input type="checkbox" name="layanan[]" value="PDP">
								<span>PDP</span>
							</label>
						</div>
						<div class="error-msg" id="error_layanan"></div>
					</div>

					<div class="input-group">
						<label for="tarif">Tarif Layanan Saat Ini <span
								class="required">*</span></label>
						<select id="tarif" name="tarif">
							<option value="">Pilih Tarif</option>
							<option value="< Rp 200.000">
								< Rp 200.000</option>
							<option value="Rp 200.000 - Rp 350.000">Rp 200.000 - Rp 350.000
							</option>
							<option value="> Rp 500.000">> Rp 500.000</option>
						</select>
						<div class="error-msg" id="error_tarif"></div>
					</div>
				</div>

				<!-- Dealing specific fields -->
				<div id="dealingFields" class="form-section" style="display: none;">
					<div class="section-title">
						<h3>Data Dealing</h3>
					</div>

					<div class="input-group">
						<label for="paket_deal">Pilih Deal Layanan
							<span class="required">*</span></label>
						<select id="paket_deal" name="paket_deal">
							<option value="">Pilih layanan</option>
							<option value="50 Mbps">Bandwidth Connectivity</option>
							<option value="75 Mbps">Digital Product</option>
							<option value="100 Mbps">Cyber Security</option>
							<option value="> 100 Mbps">Neucentrix</option>
						</select>
						<div class="error-msg" id="error_paket_deal"></div>
					</div>

					<div class="input-group">
						<label for="revenue_deal">Nominal Revenue Dealing Layanan
							<span class="required">*</span></label>
						<input type="text" id="revenue_deal" name="revenue_deal"
							placeholder="Masukkan Revenue Dealing Layanan" maxlength="20"
							inputmode="numeric">
						<div class="error-msg" id="error_revenue_deal"></div>
					</div>
				</div>

				<!-- PIC Data -->
				<div class="form-section">
					<div class="section-title">
						<h3>Data PIC Pelanggan</h3>
					</div>

					<div class="input-group">
						<label for="nama_pic">Nama PIC Pelanggan <span
								class="required">*</span></label>
						<input type="text" id="nama_pic" name="nama_pic" required
							placeholder="Nama PIC">
						<div class="error-msg" id="error_nama_pic"></div>
					</div>

					<div class="input-group">
						<label for="jabatan_pic">Jabatan PIC <span
								class="required">*</span></label>
						<input type="text" id="jabatan_pic" name="jabatan_pic" required
							placeholder="Jabatan/Posisi">
						<div class="error-msg" id="error_jabatan_pic"></div>
					</div>

					<div class="input-group">
						<label for="telepon_pic">Nomor HP PIC Pelanggan<span
								class="required">*</span></label>
						<input type="tel" id="telepon_pic" name="telepon_pic" required
							placeholder="Nomor HP PIC">
						<div class="error-msg" id="error_telepon_pic"></div>
					</div>
				</div>

				<!-- Photo Evidence -->
				<div class="form-section">
					<div class="section-title">
						<h3>Foto Evidence Visit</h3>
					</div>

					<div class="input-group">
						<label for="foto_evidence">Upload Foto <span
								class="required">*</span></label>
						<div class="photo-upload"
							onclick="document.getElementById('foto_evidence').click()">
							<div id="photoPreview" class="photo-preview"
								style="display: none;">
								<img id="previewImg" src="" alt="Preview">
								<button type="button" class="remove-photo"
									onclick="removePhoto(event)">×</button>
							</div>
							<div id="uploadPrompt" class="upload-placeholder">
								<div class="upload-icon">📷</div>
								<div class="upload-text">
									<h4>Tap untuk Upload Foto</h4>
									<p>JPG, PNG • Max 5MB</p>
								</div>
							</div>
						</div>
						<input type="file" id="foto_evidence" name="foto_evidence"
							accept="image/*" style="display: none;" required>
						<div class="error-msg" id="error_foto_evidence"></div>
					</div>
				</div>

					<!-- <div class="input-group">
						<label for="tarif">Tarif Layanan Saat Ini <span
								class="required">*</span></label>
						<select id="tarif" name="tarif">
							<option value="">Pilih Tarif</option>
							<option value="< Rp 200.000">
								< Rp 200.000</option>
							<option value="Rp 200.000 - Rp 350.000">Rp 200.000 - Rp 350.000
							</option>
							<option value="> Rp 500.000">> Rp 500.000</option>
						</select>
						<div class="error-msg" id="error_tarif"></div>
					</div> -->
				</div>

				<!-- Dealing specific fields -->
				<div id="dealingFields" class="form-section" style="display: none;">
					<div class="section-title">
						<h3>Dealing Pelanggan</h3>
					</div>

					<div class="input-group">
						<label for="paket_deal">Deal Paket berapa Mbps? <span
								class="required">*</span></label>
						<select id="paket_deal" name="paket_deal">
							<option value="">Pilih Paket</option>
							<option value="50 Mbps">50 Mbps</option>
							<option value="75 Mbps">75 Mbps</option>
							<option value="100 Mbps">100 Mbps</option>
							<option value="> 100 Mbps">> 100 Mbps</option>
						</select>
						<div class="error-msg" id="error_paket_deal"></div>
					</div>

					<div class="input-group">
						<label for="deal_bundling">Apakah dealing untuk layanan bundling? <span
								class="required">*</span></label>
						<select id="deal_bundling" name="deal_bundling">
							<option value="">Pilih Bundling</option>
							<option value="1P Internet Only">1P Internet Only</option>
							<option value="2P Internet + TV">2P Internet + TV</option>
							<option value="2P Internet + Telepon">2P Internet + Telepon
							</option>
							<option value="3P Internet + TV + Telepon">3P Internet + TV +
								Telepon</option>
						</select>
						<div class="error-msg" id="error_deal_bundling"></div>
					</div>
				</div>

				<!-- PIC Data -->

				<!-- Submit button -->
				<div class="submit-container">
					<button type="submit" class="submit-btn" id="submitButton">
						<span class="btn-text">SUBMIT DATA</span>
						<span class="btn-loader" style="display: none;">
							<div class="spinner"></div>
						</span>
					</button>
				</div>
			</form>
		</div>

		<!-- Modal for messages -->
		<div id="messageModal" class="modal-overlay" style="display: none;">
			<div class="modal-container">
				<div class="modal-icon" id="modalIcon"></div>
				<h3 id="modalTitle"></h3>
				<p id="modalMessage"></p>
				<button id="modalButton" class="modal-btn" onclick="backToMenu()">BUAT ENTRY
					BARU</button>
			</div>
		</div>
	</div>

	<!-- Custom scripts -->
	<script src="script.js"></script>

	<script>
		// NOTE: Script for Dealing Slider
		(function () {
			const sw = document.getElementById('dealSwitch');
			const hidden = document.getElementById('mode');

			// mode: 'kontrak' => knob LEFT, Kontrak slides in from RIGHT
			// mode: 'bakn'    => knob RIGHT,  BAKN slides in from LEFT
			function setMode(mode) {
				if (mode !== 'kontrak' && mode !== 'bakn') return;
				const pos = (mode === 'kontrak') ? 'left' : 'right';
				sw.dataset.pos = pos;
				sw.setAttribute('aria-checked', String(pos === 'right'));
				hidden.value = mode;
			}

			// Click ANYWHERE to choose by half
			sw.addEventListener('click', (e) => {
				const rect = sw.getBoundingClientRect();
				const x = e.clientX - rect.left;
				setMode(x < rect.width / 2 ? 'kontrak' : 'bakn');
			});

			// Keyboard (if you ever re-enable focus styling)
			sw.addEventListener('keydown', (e) => {
				if (e.key === 'ArrowLeft') setMode('kontrak');
				if (e.key === 'ArrowRight') setMode('bakn');
				if (e.key === ' ' || e.key === 'Enter') {
					e.preventDefault();
					setMode(hidden.value === 'bakn' ? 'kontrak' : 'bakn');
				}
			});

			// Init
			setMode(hidden.value === 'bakn' ? 'bakn' : 'kontrak');
		})();

		// NOTE: NEXT SECTION
		const els = document.querySelectorAll('#kode_sa, #revenue_deal');

		// Strip any non-digits after each edit (covers typing, paste, drop)
		els.forEach(el => {
			el.addEventListener('input', e => {
				const s = e.target.selectionStart;
				const t = e.target.value;
				const cleaned = t.replace(/\D+/g, '');
				if (t !== cleaned) {
					e.target.value = cleaned;
					// restore caret as best effort
					const delta = t.length - cleaned.length;
					e.target.setSelectionRange(Math.max(0, s - delta), Math.max(0, s - delta));
				}
			});
		});
	</script>
</body>

</html>
